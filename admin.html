<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ú–æ–±–∏–ª—å–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --sidebar-bg: #ffffff;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 80px;
            --primary-color: #6366f1;
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* –°–∞–π–¥–±–∞—Ä —Å—Ç–∏–ª–∏ */
        .sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            bottom: 20px;
            width: var(--sidebar-collapsed-width);
            display: flex;
            overflow: hidden;
            flex-direction: column;
            background: var(--card-bg);
            padding: 25px 15px;
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            z-index: 1000;
        }

        .sidebar:hover {
            width: var(--sidebar-width);
            padding: 25px 20px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden;
        }

        .logo {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
            opacity: 0;
            transition: opacity 0.3s ease 0.1s;
        }

        .sidebar:hover .sidebar-header h2 {
            opacity: 1;
        }

        .sidebar-lists {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }

        .menu-separation {
            height: 1px;
            background: var(--border-color);
            margin: 20px 0;
            opacity: 0;
            transition: opacity 0.3s ease 0.2s;
        }

        .sidebar:hover .menu-separation {
            opacity: 1;
        }

        .sidebar-lists h4 {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            opacity: 0;
            transition: opacity 0.3s ease 0.2s;
            white-space: nowrap;
        }

        .sidebar:hover .sidebar-lists h4 {
            opacity: 1;
        }

        .sidebar-lists li {
            margin-bottom: 8px;
        }

        .sidebar-lists a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 16px;
            text-decoration: none;
            color: var(--text-light);
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar-lists a span {
            opacity: 0;
            transition: opacity 0.3s ease 0.1s;
        }

        .sidebar:hover .sidebar-lists a span {
            opacity: 1;
        }

        .sidebar-lists a:hover,
        .sidebar-lists a.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateX(5px);
        }

        .sidebar-lists a i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .main-content {
            margin-left: calc(var(--sidebar-collapsed-width) + 40px);
            padding: 30px;
            transition: all 0.4s ease;
            min-height: 100vh;
        }

        .sidebar:hover ~ .main-content {
            margin-left: calc(var(--sidebar-width) + 40px);
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .page-title {
            font-size: 32px;
            font-weight: 800;
            color: white;
            margin: 0;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            border: none;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.primary::before { background: var(--primary-gradient); }
        .stat-card.success::before { background: linear-gradient(135deg, var(--success-color), #34d399); }
        .stat-card.warning::before { background: linear-gradient(135deg, var(--warning-color), #fbbf24); }
        .stat-card.danger::before { background: linear-gradient(135deg, var(--danger-color), #f87171); }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .stat-card-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-info h3 {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .stat-card.success .stat-info h3 { color: var(--success-color); }
        .stat-card.warning .stat-info h3 { color: var(--warning-color); }
        .stat-card.danger .stat-info h3 { color: var(--danger-color); }

        .stat-info p {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
            margin: 0;
        }

        .stat-icon {
            font-size: 48px;
            opacity: 0.8;
            color: var(--primary-color);
        }

        .stat-card.success .stat-icon { color: var(--success-color); }
        .stat-card.warning .stat-icon { color: var(--warning-color); }
        .stat-card.danger .stat-icon { color: var(--danger-color); }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            margin-bottom: 0;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 25px 30px;
        }

        .card-header h5 {
            font-weight: 700;
            color: var(--text-color);
            margin: 0;
            font-size: 18px;
        }

        .card-body {
            padding: 30px;
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .table {
            margin-bottom: 0;
            border-radius: 12px;
            overflow: hidden;
        }

        .table th {
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
            padding: 18px;
            background: rgba(99, 102, 241, 0.05);
        }

        .table td {
            padding: 18px;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-color);
        }

        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(99, 102, 241, 0.02);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #34d399);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #fbbf24);
            color: white;
        }

        .btn-outline-primary {
            border: 2px solid #6366f1;
            color: #6366f1;
            background: transparent;
        }

        .btn-outline-primary:hover {
            background: #6366f1;
            color: white;
        }

        .btn-outline-success {
            border: 2px solid var(--success-color);
            color: var(--success-color);
            background: transparent;
        }

        .btn-outline-success:hover {
            background: var(--success-color);
            color: white;
        }

        /* –ë–µ–π–¥–∂–∏ */
        .badge {
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 12px;
        }

        .badge.bg-success {
            background: var(--success-color) !important;
        }

        .badge.bg-danger {
            background: var(--danger-color) !important;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-box {
            position: relative;
        }

        .search-box .form-control {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 14px 20px 14px 45px;
            transition: all 0.3s ease;
            background: var(--card-bg);
        }

        .search-box .form-control:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
                top: 10px;
                left: 10px;
                bottom: 10px;
            }

            .sidebar:hover {
                width: var(--sidebar-width);
            }

            .main-content {
                margin-left: calc(var(--sidebar-collapsed-width) + 20px);
                padding: 20px;
            }

            .sidebar:hover ~ .main-content {
                margin-left: calc(var(--sidebar-width) + 20px);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 24px;
            }
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .recent-clients-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .client-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(99, 102, 241, 0.03);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .client-item:hover {
            background: rgba(99, 102, 241, 0.08);
            transform: translateX(5px);
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 20px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.3s ease;
            font-weight: 500;
            cursor: pointer;
        }

        .action-btn:hover {
            border-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
        }

        .action-btn i {
            font-size: 20px;
            color: #6366f1;
        }

        /* –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            cursor: pointer;
        }

        .export-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-content {
            border-radius: 20px;
            border: none;
        }

        .modal-header {
            border-bottom: 1px solid var(--border-color);
            padding: 25px 30px;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
            padding: 20px 30px;
        }

        /* –§–æ—Ä–º—ã */
        .form-control {
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .alert {
            border-radius: 12px;
            border: none;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <aside class="sidebar glass-effect">
            <div class="sidebar-header">
                <div class="logo">BT</div>
                <h2>BryTech Admin</h2>
            </div>

            <ul class="sidebar-lists">
                <h4>Main Menu</h4>
                <div class="menu-separation"></div>
                
                <li>
                    <a href="#" class="active" onclick="showSection('dashboard')">
                        <i class="bi bi-speedometer2"></i>
                        <span>–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('clients')">
                        <i class="fas fa-users"></i>
                        <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('calls')">
                        <i class="fas fa-phone"></i>
                        <span>–ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('payments')">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('reports')">
                        <i class="fas fa-chart-bar"></i>
                        <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <!-- Header -->
            <div class="page-header">
                <h1 class="page-title" id="pageTitle">–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h1>
                <div class="user-menu">
                    <div class="user-avatar">A</div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <div id="dashboard-section">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-card-content">
                            <div class="stat-info">
                                <h3 id="totalClients">0</h3>
                                <p>–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
                            </div>
                            <i class="fas fa-users stat-icon"></i>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-card-content">
                            <div class="stat-info">
                                <h3 id="activeClients">0</h3>
                                <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                            </div>
                            <i class="fas fa-user-check stat-icon"></i>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-card-content">
                            <div class="stat-info">
                                <h3 id="totalDebt">0 ‚ÇΩ</h3>
                                <p>–û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</p>
                            </div>
                            <i class="fas fa-exclamation-triangle stat-icon"></i>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-card-content">
                            <div class="stat-info">
                                <h3 id="debtorsCount">0</h3>
                                <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤</p>
                            </div>
                            <i class="fas fa-money-bill-wave stat-icon"></i>
                        </div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="card glass-effect">
                        <div class="card-header">
                            <h5>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã</h5>
                        </div>
                        <div class="card-body">
                            <div class="recent-clients-list" id="recentClients">
                                <!-- Clients will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card glass-effect">
                        <div class="card-header">
                            <h5>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="quick-actions">
                                <div class="action-btn" onclick="showSection('clients')">
                                    <i class="fas fa-user-plus"></i>
                                    <span>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</span>
                                </div>
                                <div class="action-btn" onclick="showAddPaymentModal()">
                                    <i class="fas fa-money-bill"></i>
                                    <span>–ü—Ä–∏–Ω—è—Ç—å –ø–ª–∞—Ç–µ–∂</span>
                                </div>
                                <div class="action-btn" onclick="showSection('reports')">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>–û—Ç—á–µ—Ç –ø–æ –¥–æ–ª–∂–Ω–∏–∫–∞–º</span>
                                </div>
                                <div class="action-btn" onclick="showCallModal()">
                                    <i class="fas fa-phone"></i>
                                    <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Section -->
            <div id="clients-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">
                        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                    </button>
                </div>

                <div class="card glass-effect">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="search-box">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" id="searchClients" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É...">
                                </div>
                            </div>
                            <div class="col-md-6 text-end">
                                <span class="text-muted">–ù–∞–π–¥–µ–Ω–æ: <strong id="clientsCount">0</strong> –∫–ª–∏–µ–Ω—Ç–æ–≤</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–§–ò–û</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>–ë–∞–ª–∞–Ω—Å</th>
                                        <th>–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="clientsTable">
                                    <!-- Clients will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calls Section -->
            <div id="calls-section" style="display: none;">
                <h2 class="page-title">–ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤</h2>
                <div class="card glass-effect mt-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üìû –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏</h5>
                        <button class="btn btn-primary" onclick="showCallModal()">
                            <i class="fas fa-plus me-2"></i>–ù–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody id="callsTable">
                                    <!-- Calls will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payments Section -->
            <div id="payments-section" style="display: none;">
                <h2 class="page-title">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                <div class="card glass-effect mt-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üí∞ –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h5>
                        <button class="btn btn-primary" onclick="showAddPaymentModal()">
                            <i class="fas fa-plus me-2"></i>–ù–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                                    </tr>
                                </thead>
                                <tbody id="paymentsTable">
                                    <!-- Payments will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" style="display: none;">
                <h2 class="page-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h2>
                
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportDebtorsReport()">
                        <i class="fas fa-file-word"></i>
                        –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –≤ Word
                    </button>
                    <button class="export-btn" onclick="exportFinancialReport()">
                        <i class="fas fa-file-word"></i>
                        –≠–∫—Å–ø–æ—Ä—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –≤ Word
                    </button>
                    <button class="export-btn" onclick="exportFullReport()">
                        <i class="fas fa-file-word"></i>
                        –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –≤ Word
                    </button>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card glass-effect">
                            <div class="card-header">
                                <h5>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ–ª–∂–Ω–∏–∫–∞–º</h5>
                            </div>
                            <div class="card-body">
                                <div id="debtorsReport">
                                    <!-- Debtors report will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card glass-effect">
                            <div class="card-header">
                                <h5>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                            </div>
                            <div class="card-body">
                                <div id="financialReport">
                                    <!-- Financial report will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card glass-effect">
                            <div class="card-header">
                                <h5>üìã –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h6>–ö–ª–∏–µ–Ω—Ç—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É</h6>
                                        <div id="clientsByStatus"></div>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>–¢–∏–ø—ã –∑–≤–æ–Ω–∫–æ–≤</h6>
                                        <div id="callsByType"></div>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>–¢–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π</h6>
                                        <div id="paymentsByType"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Add Client Modal -->
    <div class="modal fade" id="addClientModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-effect">
                <div class="modal-header">
                    <h5 class="modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addClientForm">
                        <div class="mb-3">
                            <label class="form-label">–§–ò–û</label>
                            <input type="text" class="form-control" id="clientFio" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                            <input type="tel" class="form-control" id="clientPhone" required placeholder="+375 25 123 4567">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</label>
                            <input type="number" class="form-control" id="clientBalance" value="0" step="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç (–º–∏–Ω—É—Ç)</label>
                            <input type="number" class="form-control" id="clientCreditLimit" value="100">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="addClient()">
                        <span id="addClientText">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</span>
                        <div class="loading" id="addClientLoading" style="display: none;"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal fade" id="addPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-effect">
                <div class="modal-header">
                    <h5 class="modal-title">üí∞ –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addPaymentForm">
                        <div class="mb-3">
                            <label class="form-label">–ö–ª–∏–µ–Ω—Ç</label>
                            <select class="form-control" id="paymentClient" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞</label>
                            <input type="number" class="form-control" id="paymentAmount" required step="0.01" min="0.01">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                            <select class="form-control" id="paymentType" required>
                                <option value="payment">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞</option>
                                <option value="withdrawal">–°–ø–∏—Å–∞–Ω–∏–µ</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                            <textarea class="form-control" id="paymentComment" rows="3" placeholder="–ü—Ä–∏—á–∏–Ω–∞ —Å–ø–∏—Å–∞–Ω–∏—è –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="addPayment()">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Call Modal -->
    <div class="modal fade" id="addCallModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-effect">
                <div class="modal-header">
                    <h5 class="modal-title">üìû –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCallForm">
                        <div class="mb-3">
                            <label class="form-label">–ö–ª–∏–µ–Ω—Ç</label>
                            <select class="form-control" id="callClient" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" class="form-control" id="callDuration" required min="1" max="180" value="5">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–¢–∏–ø –∑–≤–æ–Ω–∫–∞</label>
                            <select class="form-control" id="callType" required>
                                <option value="incoming">–í—Ö–æ–¥—è—â–∏–π</option>
                                <option value="outgoing">–ò—Å—Ö–æ–¥—è—â–∏–π</option>
                                <option value="internal">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –º–∏–Ω—É—Ç—É (—Ä—É–±)</label>
                            <input type="number" class="form-control" id="callRate" value="2.5" step="0.01" min="0">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="addCall()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let allClients = [];
        let allCalls = [];
        let allPayments = [];

        // Initialize data
        function initializeData() {
            if (!localStorage.getItem('clients')) {
                const sampleClients = [
                    {
                        _id: '1',
                        fio: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
                        phone: '+375291234567',
                        balance: 150.50,
                        creditLimit: 100,
                        status: 'active'
                    },
                    {
                        _id: '2', 
                        fio: '–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á',
                        phone: '+375292345678',
                        balance: -25.00,
                        creditLimit: 100,
                        status: 'active'
                    },
                    {
                        _id: '3',
                        fio: '–°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞ –ú–∏—Ö–∞–π–ª–æ–≤–Ω–∞',
                        phone: '+375293456789',
                        balance: 75.00,
                        creditLimit: 100,
                        status: 'active'
                    }
                ];
                localStorage.setItem('clients', JSON.stringify(sampleClients));
            }

            if (!localStorage.getItem('calls')) {
                const sampleCalls = [
                    {
                        _id: '1',
                        clientId: '1',
                        clientName: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
                        clientPhone: '+375291234567',
                        duration: 10,
                        type: 'outgoing',
                        rate: 2.5,
                        cost: 25.00,
                        date: new Date().toISOString()
                    }
                ];
                localStorage.setItem('calls', JSON.stringify(sampleCalls));
            }

            if (!localStorage.getItem('payments')) {
                const samplePayments = [
                    {
                        _id: '1',
                        clientId: '1',
                        clientName: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
                        amount: 100.00,
                        type: 'payment',
                        comment: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞',
                        date: new Date().toISOString()
                    }
                ];
                localStorage.setItem('payments', JSON.stringify(samplePayments));
            }

            // Load data from localStorage
            allClients = JSON.parse(localStorage.getItem('clients')) || [];
            allCalls = JSON.parse(localStorage.getItem('calls')) || [];
            allPayments = JSON.parse(localStorage.getItem('payments')) || [];
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('clients', JSON.stringify(allClients));
            localStorage.setItem('calls', JSON.stringify(allCalls));
            localStorage.setItem('payments', JSON.stringify(allPayments));
        }

        // Show/hide sections
        function showSection(sectionName) {
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(sectionName + '-section').style.display = 'block';
            
            document.querySelectorAll('.sidebar-lists a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const titles = {
                'dashboard': '–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å',
                'clients': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏',
                'calls': '–ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤',
                'payments': '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏',
                'reports': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];
            
            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'clients':
                    loadClients();
                    break;
                case 'calls':
                    loadCalls();
                    break;
                case 'payments':
                    loadPayments();
                    break;
                case 'reports':
                    loadReports();
                    break;
            }
        }

        // Load clients with search and filtering
        function loadClients(search = '') {
            let filteredClients = allClients;
            
            if (search) {
                const searchLower = search.toLowerCase();
                filteredClients = allClients.filter(client => 
                    client.fio.toLowerCase().includes(searchLower) || 
                    client.phone.includes(search)
                );
            }
            
            renderClientsTable(filteredClients);
            document.getElementById('clientsCount').textContent = filteredClients.length;
            updateClientDropdowns();
        }

        // Render clients table
        function renderClientsTable(clients) {
            const tbody = document.getElementById('clientsTable');
            tbody.innerHTML = clients.map(client => `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar me-3" style="width: 35px; height: 35px; font-size: 14px;">
                                ${client.fio.split(' ').map(n => n[0]).join('')}
                            </div>
                            <strong>${client.fio}</strong>
                        </div>
                    </td>
                    <td>${client.phone}</td>
                    <td class="${client.balance < 0 ? 'text-danger' : 'text-success'} fw-bold">
                        ${client.balance.toFixed(2)} ‚ÇΩ
                    </td>
                    <td>${client.creditLimit} –º–∏–Ω</td>
                    <td>
                        <span class="badge ${client.balance < 0 ? 'bg-danger' : 'bg-success'}">
                            ${client.balance < 0 ? '–î–æ–ª–∂–Ω–∏–∫' : '–ê–∫—Ç–∏–≤–Ω—ã–π'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="viewClientDetails('${client._id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="showAddPaymentForClient('${client._id}')">
                            <i class="fas fa-money-bill"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Add new client
        function addClient() {
            const fio = document.getElementById('clientFio').value;
            const phone = document.getElementById('clientPhone').value;
            const balance = parseFloat(document.getElementById('clientBalance').value) || 0;
            const creditLimit = parseInt(document.getElementById('clientCreditLimit').value) || 100;

            if (!fio || !phone) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            if (allClients.some(client => client.phone === phone)) {
                alert('–ö–ª–∏–µ–Ω—Ç —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }

            const newClient = {
                _id: Date.now().toString(),
                fio: fio,
                phone: phone,
                balance: balance,
                creditLimit: creditLimit,
                status: 'active',
                createdAt: new Date().toISOString()
            };

            allClients.push(newClient);
            saveData();

            bootstrap.Modal.getInstance(document.getElementById('addClientModal')).hide();
            document.getElementById('addClientForm').reset();
            
            showNotification('–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            loadClients();
            loadDashboard();
        }

        // Load dashboard statistics
        function loadDashboard() {
            const totalClients = allClients.length;
            const activeClients = allClients.filter(c => c.balance >= 0).length;
            const debtors = allClients.filter(c => c.balance < 0);
            const totalDebt = debtors.reduce((sum, d) => sum + Math.abs(d.balance), 0);
            
            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('activeClients').textContent = activeClients;
            document.getElementById('debtorsCount').textContent = debtors.length;
            document.getElementById('totalDebt').textContent = totalDebt.toFixed(2) + ' ‚ÇΩ';
            
            const recentClients = allClients.slice(-5).reverse();
            document.getElementById('recentClients').innerHTML = recentClients.map(client => `
                <div class="client-item">
                    <div>
                        <strong>${client.fio}</strong>
                        <div class="text-muted small">${client.phone}</div>
                    </div>
                    <span class="badge ${client.balance < 0 ? 'bg-danger' : 'bg-success'}">
                        ${client.balance.toFixed(2)} ‚ÇΩ
                    </span>
                </div>
            `).join('');
        }

        // Load calls
        function loadCalls() {
            const tbody = document.getElementById('callsTable');
            tbody.innerHTML = allCalls.map(call => `
                <tr>
                    <td>${call.clientName}</td>
                    <td>${call.clientPhone}</td>
                    <td>${call.duration} –º–∏–Ω</td>
                    <td>
                        <span class="badge ${call.type === 'incoming' ? 'bg-success' : call.type === 'outgoing' ? 'bg-primary' : 'bg-secondary'}">
                            ${call.type === 'incoming' ? '–í—Ö–æ–¥—è—â–∏–π' : call.type === 'outgoing' ? '–ò—Å—Ö–æ–¥—è—â–∏–π' : '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π'}
                        </span>
                    </td>
                    <td>${new Date(call.date).toLocaleDateString()}</td>
                    <td class="fw-bold">${call.cost.toFixed(2)} ‚ÇΩ</td>
                </tr>
            `).join('');
        }

        // Load payments
        function loadPayments() {
            const tbody = document.getElementById('paymentsTable');
            tbody.innerHTML = allPayments.map(payment => `
                <tr>
                    <td>${payment.clientName}</td>
                    <td class="${payment.type === 'payment' ? 'text-success' : 'text-danger'} fw-bold">
                        ${payment.type === 'payment' ? '+' : '-'}${payment.amount.toFixed(2)} ‚ÇΩ
                    </td>
                    <td>
                        <span class="badge ${payment.type === 'payment' ? 'bg-success' : 'bg-warning'}">
                            ${payment.type === 'payment' ? '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : '–°–ø–∏—Å–∞–Ω–∏–µ'}
                        </span>
                    </td>
                    <td>${new Date(payment.date).toLocaleDateString()}</td>
                    <td><span class="badge bg-success">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span></td>
                    <td>${payment.comment || '-'}</td>
                </tr>
            `).join('');
        }

        // Load reports
        function loadReports() {
            const debtors = allClients.filter(c => c.balance < 0);
            const totalRevenue = allPayments
                .filter(p => p.type === 'payment')
                .reduce((sum, p) => sum + p.amount, 0);
            const totalCallsCost = allCalls.reduce((sum, c) => sum + c.cost, 0);
            
            document.getElementById('debtorsReport').innerHTML = `
                <div class="mb-3">
                    <h6 class="text-muted">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤</h6>
                    <h3 class="text-danger">${debtors.length}</h3>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted">–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–æ–≤</h6>
                    <h3 class="text-danger">${debtors.reduce((sum, d) => sum + Math.abs(d.balance), 0).toFixed(2)} ‚ÇΩ</h3>
                </div>
                ${debtors.length > 0 ? `
                    <div>
                        <h6 class="text-muted">–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–ª–∂–Ω–∏–∫–∏:</h6>
                        <ul class="list-unstyled">
                            ${debtors.slice(0, 3).map(d => `
                                <li class="mb-2">
                                    <small>${d.fio}</small><br>
                                    <strong class="text-danger">${Math.abs(d.balance).toFixed(2)} ‚ÇΩ</strong>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                ` : '<p class="text-success">–î–æ–ª–∂–Ω–∏–∫–æ–≤ –Ω–µ—Ç</p>'}
            `;
            
            document.getElementById('financialReport').innerHTML = `
                <div class="mb-3">
                    <h6 class="text-muted">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</h6>
                    <h3 class="text-success">${totalRevenue.toFixed(2)} ‚ÇΩ</h3>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted">–î–æ—Ö–æ–¥ –æ—Ç –∑–≤–æ–Ω–∫–æ–≤</h6>
                    <h3 class="text-primary">${totalCallsCost.toFixed(2)} ‚ÇΩ</h3>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</h6>
                    <h3>${allClients.length}</h3>
                </div>
            `;

            // Additional statistics
            const activeClients = allClients.filter(c => c.balance >= 0).length;
            const debtorsCount = debtors.length;
            
            const incomingCalls = allCalls.filter(c => c.type === 'incoming').length;
            const outgoingCalls = allCalls.filter(c => c.type === 'outgoing').length;
            const internalCalls = allCalls.filter(c => c.type === 'internal').length;
            
            const paymentCount = allPayments.filter(p => p.type === 'payment').length;
            const withdrawalCount = allPayments.filter(p => p.type === 'withdrawal').length;

            document.getElementById('clientsByStatus').innerHTML = `
                <div class="mb-2">
                    <span class="text-success">‚óè –ê–∫—Ç–∏–≤–Ω—ã–µ:</span> ${activeClients}
                </div>
                <div class="mb-2">
                    <span class="text-danger">‚óè –î–æ–ª–∂–Ω–∏–∫–∏:</span> ${debtorsCount}
                </div>
                <div class="mb-2">
                    <span class="text-primary">‚óè –í—Å–µ–≥–æ:</span> ${allClients.length}
                </div>
            `;

            document.getElementById('callsByType').innerHTML = `
                <div class="mb-2">
                    <span class="text-success">‚óè –í—Ö–æ–¥—è—â–∏–µ:</span> ${incomingCalls}
                </div>
                <div class="mb-2">
                    <span class="text-primary">‚óè –ò—Å—Ö–æ–¥—è—â–∏–µ:</span> ${outgoingCalls}
                </div>
                <div class="mb-2">
                    <span class="text-secondary">‚óè –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:</span> ${internalCalls}
                </div>
                <div class="mb-2">
                    <span class="text-dark">‚óè –í—Å–µ–≥–æ:</span> ${allCalls.length}
                </div>
            `;

            document.getElementById('paymentsByType').innerHTML = `
                <div class="mb-2">
                    <span class="text-success">‚óè –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</span> ${paymentCount}
                </div>
                <div class="mb-2">
                    <span class="text-warning">‚óè –°–ø–∏—Å–∞–Ω–∏—è:</span> ${withdrawalCount}
                </div>
                <div class="mb-2">
                    <span class="text-dark">‚óè –í—Å–µ–≥–æ:</span> ${allPayments.length}
                </div>
            `;
        }

        // Update client dropdowns in modals
        function updateClientDropdowns() {
            const paymentClientSelect = document.getElementById('paymentClient');
            const callClientSelect = document.getElementById('callClient');
            
            paymentClientSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>';
            callClientSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>';
            
            allClients.forEach(client => {
                const option = `<option value="${client._id}">${client.fio} (${client.phone})</option>`;
                paymentClientSelect.innerHTML += option;
                callClientSelect.innerHTML += option;
            });
        }

        // Show add payment modal
        function showAddPaymentModal() {
            updateClientDropdowns();
            const modal = new bootstrap.Modal(document.getElementById('addPaymentModal'));
            modal.show();
        }

        // Show add payment for specific client
        function showAddPaymentForClient(clientId) {
            updateClientDropdowns();
            document.getElementById('paymentClient').value = clientId;
            const modal = new bootstrap.Modal(document.getElementById('addPaymentModal'));
            modal.show();
        }

        // Add payment
        function addPayment() {
            const clientId = document.getElementById('paymentClient').value;
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const type = document.getElementById('paymentType').value;
            const comment = document.getElementById('paymentComment').value;

            if (!clientId || !amount || amount <= 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                return;
            }

            const client = allClients.find(c => c._id === clientId);
            if (!client) {
                alert('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            if (type === 'payment') {
                client.balance += amount;
            } else {
                client.balance -= amount;
            }

            const newPayment = {
                _id: Date.now().toString(),
                clientId: clientId,
                clientName: client.fio,
                amount: amount,
                type: type,
                comment: comment,
                date: new Date().toISOString()
            };

            allPayments.push(newPayment);
            saveData();

            bootstrap.Modal.getInstance(document.getElementById('addPaymentModal')).hide();
            document.getElementById('addPaymentForm').reset();
            
            showNotification('–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            loadPayments();
            loadDashboard();
            loadClients();
        }

        // Show call modal
        function showCallModal() {
            updateClientDropdowns();
            const modal = new bootstrap.Modal(document.getElementById('addCallModal'));
            modal.show();
        }

        // Add call
        function addCall() {
            const clientId = document.getElementById('callClient').value;
            const duration = parseInt(document.getElementById('callDuration').value);
            const type = document.getElementById('callType').value;
            const rate = parseFloat(document.getElementById('callRate').value);

            if (!clientId || !duration || duration <= 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                return;
            }

            const client = allClients.find(c => c._id === clientId);
            if (!client) {
                alert('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            const cost = duration * rate;

            if (client.balance < cost && type !== 'internal') {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ —Å—á–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞');
                return;
            }

            if (type !== 'internal') {
                client.balance -= cost;
            }

            const newCall = {
                _id: Date.now().toString(),
                clientId: clientId,
                clientName: client.fio,
                clientPhone: client.phone,
                duration: duration,
                type: type,
                rate: rate,
                cost: cost,
                date: new Date().toISOString()
            };

            allCalls.push(newCall);
            saveData();

            bootstrap.Modal.getInstance(document.getElementById('addCallModal')).hide();
            document.getElementById('addCallForm').reset();
            
            showNotification('–ó–≤–æ–Ω–æ–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'success');
            loadCalls();
            loadDashboard();
            loadClients();
        }

        // View client details
        function viewClientDetails(clientId) {
            const client = allClients.find(c => c._id === clientId);
            if (client) {
                alert(`–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞:\n\n–§–ò–û: ${client.fio}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${client.phone}\n–ë–∞–ª–∞–Ω—Å: ${client.balance.toFixed(2)} ‚ÇΩ\n–ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç: ${client.creditLimit} –º–∏–Ω`);
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show`;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.main-content').insertBefore(notification, document.querySelector('.main-content').firstChild);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Export functions
        function exportDebtorsReport() {
            const debtors = allClients.filter(c => c.balance < 0);
            const totalDebt = debtors.reduce((sum, d) => sum + Math.abs(d.balance), 0);
            
            const content = `
                –û—Ç—á–µ—Ç –ø–æ –¥–æ–ª–∂–Ω–∏–∫–∞–º
                –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleDateString()}
                
                –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤: ${debtors.length}
                –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏: ${totalDebt.toFixed(2)} ‚ÇΩ
                
                –°–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–∏–∫–æ–≤:
                ${debtors.map((debtor, index) => `
                ${index + 1}. ${debtor.fio}
                   –¢–µ–ª–µ—Ñ–æ–Ω: ${debtor.phone}
                   –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: ${Math.abs(debtor.balance).toFixed(2)} ‚ÇΩ
                `).join('')}
                
                –° —É–≤–∞–∂–µ–Ω–∏–µ–º,
                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è BryTech
            `;

            exportToWord(content, '–û—Ç—á–µ—Ç_–ø–æ_–¥–æ–ª–∂–Ω–∏–∫–∞–º');
        }

        function exportFinancialReport() {
            const totalRevenue = allPayments
                .filter(p => p.type === 'payment')
                .reduce((sum, p) => sum + p.amount, 0);
            const totalCallsCost = allCalls.reduce((sum, c) => sum + c.cost, 0);
            const activeClients = allClients.filter(c => c.balance >= 0).length;
            const debtors = allClients.filter(c => c.balance < 0);
            
            const content = `
                –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç
                –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleDateString()}
                
                –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
                - –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${allClients.length}
                - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: ${activeClients}
                - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤: ${debtors.length}
                
                –§–ò–ù–ê–ù–°–û–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:
                - –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${totalRevenue.toFixed(2)} ‚ÇΩ
                - –î–æ—Ö–æ–¥ –æ—Ç –∑–≤–æ–Ω–∫–æ–≤: ${totalCallsCost.toFixed(2)} ‚ÇΩ
                - –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: ${debtors.reduce((sum, d) => sum + Math.abs(d.balance), 0).toFixed(2)} ‚ÇΩ
                
                –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–ü–ï–†–ê–¶–ò–ô:
                - –í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π: ${allPayments.length}
                - –í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤: ${allCalls.length}
                - –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–π —Å—á–µ—Ç–∞: ${allPayments.filter(p => p.type === 'payment').length}
                - –°–ø–∏—Å–∞–Ω–∏–π: ${allPayments.filter(p => p.type === 'withdrawal').length}
                
                –° —É–≤–∞–∂–µ–Ω–∏–µ–º,
                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è BryTech
            `;

            exportToWord(content, '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π_–æ—Ç—á–µ—Ç');
        }

        function exportFullReport() {
            const debtors = allClients.filter(c => c.balance < 0);
            const totalRevenue = allPayments
                .filter(p => p.type === 'payment')
                .reduce((sum, p) => sum + p.amount, 0);
            const totalCallsCost = allCalls.reduce((sum, c) => sum + c.cost, 0);
            
            const content = `
                –ü–û–õ–ù–´–ô –û–¢–ß–ï–¢ –°–ò–°–¢–ï–ú–´
                –î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleDateString()}
                –í—Ä–µ–º—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleTimeString()}
                
                –†–ê–ó–î–ï–õ 1: –ö–õ–ò–ï–ù–¢–´
                ===================
                –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${allClients.length}
                –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: ${allClients.filter(c => c.balance >= 0).length}
                –î–æ–ª–∂–Ω–∏–∫–æ–≤: ${debtors.length}
                –û–±—â–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å: ${debtors.reduce((sum, d) => sum + Math.abs(d.balance), 0).toFixed(2)} ‚ÇΩ
                
                –†–ê–ó–î–ï–õ 2: –§–ò–ù–ê–ù–°–´
                ==================
                –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${totalRevenue.toFixed(2)} ‚ÇΩ
                –î–æ—Ö–æ–¥ –æ—Ç –∑–≤–æ–Ω–∫–æ–≤: ${totalCallsCost.toFixed(2)} ‚ÇΩ
                –í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π: ${allPayments.length}
                
                –†–ê–ó–î–ï–õ 3: –ó–í–û–ù–ö–ò
                ================
                –í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤: ${allCalls.length}
                –í—Ö–æ–¥—è—â–∏—Ö: ${allCalls.filter(c => c.type === 'incoming').length}
                –ò—Å—Ö–æ–¥—è—â–∏—Ö: ${allCalls.filter(c => c.type === 'outgoing').length}
                –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö: ${allCalls.filter(c => c.type === 'internal').length}
                
                –†–ê–ó–î–ï–õ 4: –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
                ==============================
                ${allClients.map((client, index) => `
                –ö–ª–∏–µ–Ω—Ç ${index + 1}:
                - –§–ò–û: ${client.fio}
                - –¢–µ–ª–µ—Ñ–æ–Ω: ${client.phone}
                - –ë–∞–ª–∞–Ω—Å: ${client.balance.toFixed(2)} ‚ÇΩ
                - –°—Ç–∞—Ç—É—Å: ${client.balance < 0 ? '–î–æ–ª–∂–Ω–∏–∫' : '–ê–∫—Ç–∏–≤–Ω—ã–π'}
                - –ö—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç: ${client.creditLimit} –º–∏–Ω
                `).join('')}
                
                –° —É–≤–∞–∂–µ–Ω–∏–µ–º,
                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è BryTech
                –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω: +375 25 608 2909
            `;

            exportToWord(content, '–ü–æ–ª–Ω—ã–π_–æ—Ç—á–µ—Ç_—Å–∏—Å—Ç–µ–º—ã');
        }

        function exportToWord(content, filename) {
            // Create a Blob with the content
            const blob = new Blob([content], { type: 'application/msword' });
            
            // Create download link
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.doc`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ Word', 'success');
        }

        // Search functionality
        document.getElementById('searchClients').addEventListener('input', function(e) {
            loadClients(e.target.value);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            loadDashboard();
            updateClientDropdowns();
        });
    </script>
</body>
</html>